<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Make More Time"><title>计算机网络知识树 | Ranranran</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">计算机网络知识树</h1><a id="logo" href="/.">Ranranran</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">计算机网络知识树</h1><div class="post-meta">May 8, 2018<span> | </span><span class="category"><a href="/categories/计算机网络/">计算机网络</a></span></div><div class="post-content"><h3 id="网络分层模型概要"><a href="#网络分层模型概要" class="headerlink" title="网络分层模型概要"></a>网络分层模型概要</h3><ul>
<li>OSI七层协议：<ol>
<li>物理层</li>
<li>数据链路层</li>
<li>网络层</li>
<li>运输层</li>
<li>会话层</li>
<li>表示层</li>
<li>应用层</li>
</ol>
</li>
<li>TCP/IP四层协议：<ol>
<li>网络接口层（对应OSI的物理层和数据链路层）</li>
<li>网际层IP（对应OSI的网络层）</li>
<li>运输层（TCP/UDP 对应OSI的运输层）</li>
<li>应用层（各种应用层协议如TELNET,FTP.SMTP等 对应OSI的会话、表示和应用层）</li>
</ol>
</li>
<li>五层协议（常用）：<ol>
<li>物理层</li>
<li>数据链路层</li>
<li>网络层</li>
<li>运输层</li>
<li>应用层<h4 id="以五层协议从上往下来简述各层的主要功能"><a href="#以五层协议从上往下来简述各层的主要功能" class="headerlink" title="以五层协议从上往下来简述各层的主要功能"></a>以五层协议从上往下来简述各层的主要功能</h4></li>
</ol>
</li>
</ul>
<ol>
<li>应用层 （application layer）<ul>
<li>任务：通过应用 <strong>进程</strong> 间的交互来完成 <strong>特定网络应用</strong> ，应用层协议定义的时应用进程间通信和交互的规则。</li>
<li>协议：HTTP DNS SMTP等</li>
<li>数据单元：报文</li>
</ul>
</li>
<li>运输层 (transport layer)<ul>
<li>任务：向两台主机中 <strong>进程</strong> 之间的通信提供 <strong>通用</strong> 的数据传输服务。应用层协议多路复用运输层的协议。</li>
<li>协议：传输控制协议TCP（Transmission Control Protocol）提供面向连接的、可靠的数据传输服务<br>用户数据报协议UDP（User Datagram Protocol）提供无连接的、尽最大努力传输的数据传输服务（不保证数据传输的可靠性）</li>
<li>数据单元：TCP-报文段 UDP-用户数据报</li>
</ul>
</li>
<li>网络层 (network layer)<ul>
<li>任务: 为分组交换网上的不同 <strong>主机</strong> 提供通信服务。网络层把运输层产生的报文段或用户数据报封装成分组或包（IP分片）。IP数据报分片对传输层透明。<br>选择合适的路由，使源主机运输层所传下来的分组，能够通过网络中的路由器找到目的主机。</li>
<li>协议：IP协议。（Internet Protocol）及路由选择协议。</li>
<li>数据单元：IP数据报或数据报（分组）。</li>
</ul>
</li>
<li>数据链路层<ul>
<li>任务：在两个 <strong>相邻节点之间的物理线路</strong> 上（有线和无线）传输数据时，数据链路层将网络层交下来的IP数据报 <strong>组装成帧</strong> ，在两个相邻节点上传送帧。每一帧包括数据和必要的控制信息。</li>
<li>协议：PPP协议、CSMA/CD协议、802.11、WI-FI。</li>
<li>数据单元：PPP帧和MAC帧（以太网帧）。</li>
</ul>
</li>
<li>物理层<ul>
<li>任务：尽可能屏蔽传输媒体和通信手段的差异，使物理层上面的数据链路层感觉不到这些差异，这样就可使数据链路层只考虑如何完成本层的协议和服务，而不必考虑网络具体的传输媒体和通信手段是什么。</li>
<li>规程：</li>
<li>数据单元：比特。</li>
</ul>
</li>
</ol>
<h3 id="网段的概念"><a href="#网段的概念" class="headerlink" title="网段的概念"></a>网段的概念</h3><ul>
<li>由于网段由三种含义，分别对应三个层次，特拿出单说</li>
</ul>
<ol>
<li>在物理层：<br>与物理层的冲突域概念相同。<br>在以太网环境中，一个网段其实也就是一个冲突域（碰撞域）。同一网段中的设备共享（包括通过集线器等设备中转连接）同一物理总线，在这一总线上执行CSMA/CD（载波监听多路访问/冲突检测）机制。不同网段间不共享同一物理层，因此不会跨网段发生冲突（碰撞）。<br>现代高速以太网通常使用交换机代替集线器，交换机是工作在数据链路层的设备，由它转接的两组设备不在同一网段中。事实上，交换机为连在其上的每一个独立设备各自划分出一个独立的网段，每个网段只包含两个设备——交换机本身，和这个独立设备。这样，交换机就能隔离冲突，提高网络的利用率和总体性能。</li>
<li>在数据链路层：<br>与广播域概念相同。<br>前面所讨论的学术定义是“网段”在物理层的严格定义，“网段”还有一些不严格的含义，比如指代以太网上的一个广播域，这是数据链路层上一个独立的内部相互作用区域。</li>
<li><p>在网络层：<br>与子网概念相同。<br>或者在中文的网络知识入门中，这个词更经常地被误用来指代“子网”，也就是网络层中由网关或路由器等设备隔开的不同部分。例如IP为 192.168.0.1 ~ 192.168.0.254 的设备就位于掩码 255.255.255.0 的同一子网中，这句话经常被说成“位于192.168.0.x ‘网段’中”，如果不涉及网络层之下的结构，这么说不会引起混淆，但是在深入探讨互联网底层结构的时候，应该避免使用“网段”来指代“子网”。</p>
<p>————以上三条摘自<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E6%AE%B5" target="_blank" rel="noopener">维基百科</a>。</p>
</li>
</ol>
<h3 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h3><ol>
<li>功能：物理层考虑的是怎样才能在链接各种计算机的后窜数媒体上传输数据，而不是值具体的传输媒体。物理层的协议称为 <strong>物理层规程</strong> ，其实就是物理层的协议，只是在协议这个名次出现之前人们就先使用了规程。<br>主要任务描述为确定与传输媒体的接口有关的一些特性，即：<ol>
<li><strong>机械特性</strong>  指明接口所用的接线器的形状和尺寸、引脚数目和排列、固定和锁定装置等。平时常见的各种规格的接插件都有严格的标准化规定。</li>
<li><strong>电器特性</strong>  指明在接口电缆的各条线上出现的电压的范围。</li>
<li><strong>功能特性</strong>  指明某条线上出现的某一电平的电压的意义。</li>
<li><strong>过程特性</strong>  指明对于不同功能的各种可能事件的出现顺序。</li>
<li>还要完成串行传输和并行传输的转换。</li>
</ol>
</li>
<li>传输媒体<ol>
<li>双绞线。最古老也是最常用的传输媒体。把两根互相绝缘的铜导线并排放在一起，然后用规则的方法绞合起来就构成了双绞线，减少对相邻导线的电磁干扰。局域网基本都采用双绞线作为传输媒体。</li>
<li>同轴电缆。由内导体铜制芯线、绝缘层、网状编织的外导体屏蔽层以及保护塑料外层所组成。具有很好的抗干扰性。在局域网发展初期曾广泛使用。</li>
<li>光缆。利用光导纤维传递光脉冲来进行通信。有光脉冲相当1，没有光脉冲相当于0.由于可见光的频率非常高，约为10的8次方MHz的量级，因此一个光纤通信系统的传输带宽远远大于目前其他各种传输媒体的带宽。多模光纤-光脉冲在多模光纤中传输时会逐渐展宽，造成失真。只适合近距离传输。单模光纤的直径只有一个光的波长，可使光线一直向前传播而不会产生多次反射。<br>光纤的优点：<ol>
<li>通信容量很大。</li>
<li>抗雷电和电磁干扰性能好，这在有大电流脉冲干扰的环境下尤为重要。</li>
<li>五串音干扰，保密性好，也不易被窃听或截取数据。</li>
<li>传输损耗小，终极距离长，对远距离传输特别经济。</li>
<li>体积小，重量轻。</li>
</ol>
</li>
<li>非导引型传输媒体</li>
</ol>
</li>
<li>信道复用技术<ol>
<li>频分复用</li>
<li>时分复用</li>
<li>统计时分复用</li>
<li>波分复用</li>
<li>码分复用</li>
</ol>
</li>
<li>信道：信道和电路并不等同，信道一般用来表示向某一个方向传送信息的媒体，因此，一条通信电路往往包含一条发送信道和一条接收信道。</li>
<li>设备：集线器、转发器。</li>
</ol>
<h3 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h3><p>  在两个 <strong>相邻节点之间的物理线路</strong> 上（有线和无线）传输数据时，数据链路层将网络层交下来的IP数据报 <strong>组装成帧</strong> ，在两个相邻节点上传送帧。每一帧包括数据和必要的控制信息。</p>
<ol>
<li>数据链路层属于计算机网络的底层，数据链路层实用的信道主要有以下两种类型<ol>
<li>点对点信道。这种信道使用一对一的点对点通信方式。</li>
<li>广播信道。这种信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上链接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。</li>
</ol>
</li>
<li>实现的目的：在同一个局域网中分组怎样从一台主机传送到另一台主机，但并不经过路由器转发。局域网属于数据链路层的范围。</li>
<li>使用点对点信道的数据链路层<ul>
<li>链路：link，从一个节点到相邻节点的一段物理线路，中间没有其他节点。</li>
<li>数据链路：data link，当需要在一条线路上传送数据时，除了必须有一条物理线路。还必须要一些通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。</li>
<li>帧：数据链路层把网络层交下来的数据（IP数据报）构成帧（加上首部尾部）发送到连路上，以及把接收到的帧中的数据取出（去掉首部尾部）并上交给网络层。</li>
</ul>
</li>
<li>数据链路层的三个基本问题<ol>
<li><strong>封装成帧</strong><br>封装成帧（framing）就是在一段数据的前后分别添加手部和尾部，这样就构成了一个帧，接收端在收到物理岑上交的比特流后，就能根据首部和尾部标记，从收到的比特流中识别帧的开始和结束。每一种链路层协议都会定了能传送帧的数据部分长度上限MTU最大传送单元（默认1500字节）。帧开始符SOH的ASCII十六进制编码01H结束符EOT 04H（并不是三个字母）。</li>
<li><strong>透明传输</strong><br>如果数据部分是非ASCII码的文本文件（如二进制代码的计算机程序或图像等）可能会出现与SOH和EOT这种控制字符一样的二进制代码。解决方法：发送端的数据链路层在数据中出现控制字符SOH或EOT的前面差一个 <strong>转义字符</strong> ESC（1B）而在接收端的数据链路层在把数据送往网络层呢个之前删除这个插入的转义字符，称为字节填充或字符填充。如果转义字符也出现在数据当中，就在前面再加一个ESC。</li>
<li><strong>差错检测</strong><ol>
<li>比特差错：0可能变成1，1可能变成0，目前在数据链路层广泛采用了循环冗余检验CRC，将检验结果添加在数据后面称FCS冗余码。</li>
<li>出现传输差错：帧丢失、真重复、帧失序。<br>CRC能够实现无比特差错，还不是可靠传输。对于传输差错：</li>
</ol>
<ul>
<li>对于通信质量好的有线传输链路，数据链路层协议不使用确认和重传据机制，不要求数据链路层向上提供可靠传输的服务。如果在数据链路层传输数据时出现了差错并且需要改正，那么改正差错的任务就由上层协议如TCP来完成。</li>
<li>对于通信质量较差的无线传输链路，数据链路层协议使用确认和重传机制，数据链路层向上提供可靠传输的服务。</li>
</ul>
</li>
</ol>
</li>
<li>点对点协议PPP（电话网）<br>互联网用户通常都要连接到某个ISP才能连接互联网，PPP协议就是用户计算机和ISP进行通信时所使用的数据链路层协议。<ul>
<li>步骤：（详见《网络协议分析》）<ol>
<li>PPP协议的对等段分别是客户和ISP(Internet Service Provider)，他们通过Modem和电话网络连接。电话通信采用虚电路的放射式，当客户拨通ISP后，它们之间就建立了一条虚拟的直连链路，这就是点到点的由来。（ISP提供一个Modem池用以接受不同用户的请求）</li>
<li>利用LCP建立PPP链路。（配置实用的认证协议、最大接受单元、压缩协议等）</li>
<li>利用PAP或CHAP验证客户身份（提供站好和口令）</li>
<li>用IPCP配置IP层参数（主要是IP地址）</li>
<li>用LCP断开PPP链路，再断开物理链路</li>
</ol>
</li>
<li>PPPoE<br>以太网上的PPP协议，用于基于以太网介入ISP的场合。传统基于PPP的拨号链路无法满足想以太网一样的高带宽需求，所以融合了PPP的基于用户的认证、控制、服务及记账功能<br>流程：<ol>
<li>发现阶段（包括客户端发起，服务端提供（多个），客户端请求，服务端确认）</li>
<li>PPP会话阶段</li>
</ol>
</li>
</ul>
</li>
<li><p>802.3标准以太网（局域网）</p>
<ul>
<li>局域网工作的层次跨越了数据链路层和物理层，局域网技术中有关数据链路层的内容比较丰富，把局域网放在数据链路层讨论，但这并不表示局域网仅仅和数据链路层有关。</li>
<li>共享信道：如何使众多用户能够合理而方便的共享通信媒体资源<br>以太网的随机接入，所有用户可随机发送信息，如果恰巧有两个或更多的用户在同一时刻发送信息，那么在贡献向媒体上就要产生 <strong>碰撞</strong> （发生了冲突），使得所有用户发送都失败。</li>
<li>CSMA/CD协议<br>最早的以太网是将许多计算机都连接到一根总线上。其特点是总线上的所有计算机都能检测到这个数据，也就是广播方式。但我们并不总是要在局域网上进行一对多的广播通信。为了在总线上实现一对一的通信，出现了MAC地址——使每一台计算机的适配器拥有一个与其他适配器都不同的地址，仅当数据帧中的目的地址与适配器ROM中存放的硬件地址一致时，该适配器才接受这个消息，否则丢弃。这样，具有广播性质的总线上就实现了一对一的通信。<ol>
<li><strong>多点介入</strong> ：说明这是总线型网络，许多计算机以多点接入的方式连接在一根线上。协议的实质时载波监听和碰撞检测。</li>
<li><strong>载波监听</strong> ：检测信道。不管在发送前还是再发送终，每个站都必须不停的检测信道。如果检测到已经有其他主机在发送数据，自己就暂时不发送数据。</li>
<li><strong>碰撞检测</strong> ：边发送边监听。一旦发现总线上出现了碰撞，适配器就立即停止发送。</li>
</ol>
</li>
<li><p>使用集线器的星型拓扑</p>
<ol>
<li>从表面上看，使用集线器的局域网在物理上是一个星型网，但由于集线器使用电子器件来模拟实际电缆工作，因此整个系统仍像一个传统以太网那样运行，使用集线器的以太网在逻辑上仍是一个总线网，各站共享逻辑上的总线。使用的还是CSMA/CD协议（更具体地说，是各站中的适配器执行CSMA/CD协议）。网络中的各站必须竞争对传输媒体的控制，并且在同一时刻至多只允许一个站发送数据。</li>
<li>一个集线器有许多接口，8-16个，每个接口通过RJ-45插头用两队霜剑仙于一台计算机上的适配器相连。因此，一个集线器很像多接口的转发器。</li>
<li>集线器工作在物理层，它的每个接口仅仅简单的转发比特，不进行碰撞检测。</li>
</ol>
</li>
<li><p>MAC帧<br>广播帧：MAC目的地址全1<br>与PPP帧共同构成数据链路成的帧。</p>
</li>
<li><p><strong>扩展的以太网</strong><br>在许多情况下，我们需要对以太网的覆盖范围进行扩展。这种扩展的以太网在网络层看来还是一个网络。</p>
<ol>
<li>在物理层扩展以太网<ul>
<li>使用多个集线器，就可以链接覆盖更大范围的多级星型结构的以太网。</li>
<li>将若干独立的碰撞域用集线器连起来，形成一个更大的碰撞域，某两个原小碰撞域的站点相互通信会影响全部的碰撞域。</li>
<li>如果不同的小碰撞域使用不同的以太网技术（如数据率不同），那就不可能用集线器连起来，它并不能把帧进行缓存。</li>
</ul>
</li>
<li>在数据链路层扩展以太网：<br>扩展以太网更常用的方法实在数据链路层进行。最初人们使用的是网桥。<ol>
<li>网桥：收到一个帧时，并不是想所有的接口转发此帧，而是根据此帧的目的MAC地址查找网桥中的地址表，然后确定将其转发到那一个接口，或者把它丢弃。</li>
<li>交换机：1990年问世的交换式集线器，很快就淘汰了网桥。也成为以太网交换机或第二层交换机。<ul>
<li>特点：</li>
</ul>
<ol>
<li>实质上就是一个多接口的网桥，通常有十几个或更多的接口。</li>
<li>以太网交换机每个接口直接与一个单台主机或另一个以太网交换机相连，并且一般都工作在全双工方式。</li>
<li>以太网交换机还具有并行性，能通过连通多对接口，使多对主机能同时通信。相互通信的主机都是独占传输媒体，无碰撞的传输数据。</li>
<li>以太网交换机的接口还有存储器，能在接口繁忙时把来到的帧缓存。</li>
<li>以太网交换机由于使用了专用的交换结构芯片，用硬件转发，其转发速率比用软件转发的网桥快很多。</li>
<li>一般都具有多种速率的接口。</li>
</ol>
<ul>
<li>以太网交换机的自学习功能<br>维护一个MAC地址表。</li>
</ul>
</li>
</ol>
</li>
<li>以太网帧长度：1500字节数据+22字节首部。其中首部包含4字节VLAN标识</li>
</ol>
</li>
</ul>
</li>
<li>802.1Q虚拟局域网VLAN<ul>
<li>定义：虚拟局域网VLAN是由一些局域网网段构成的与物理位置无关的逻辑组，而这些网段有某些共同的需求。每一个VLAN帧都有一个明确的标识符，指明发送这个帧的计算机属于哪一个VLAN，插入VLAN标记的帧称为802.1Q帧。</li>
<li>只是局域网给用户提供的一种服务，并不是一种新型局域网。</li>
</ul>
</li>
</ol>
<h3 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h3><h4 id="网络层提供的两种服务："><a href="#网络层提供的两种服务：" class="headerlink" title="网络层提供的两种服务："></a>网络层提供的两种服务：</h4><ol>
<li>虚电路服务（参考了电信网）<ul>
<li>思路：可靠通信应当由网络来保证。即建立连接后通信。</li>
<li>终点地址：尽在建立连接时使用，每个分组使用短的虚电路号。</li>
<li>分组的转发、顺序：属于同一条虚电路的分组均按统一路由按顺序到达终点。</li>
<li>节点出故障时：所有通过故障节点的虚电路均不能正常工作。</li>
<li>端到端的差错处理和流量控制：可以由网络负责，也可以由用户主机负责</li>
</ul>
</li>
<li>数据报服务<ul>
<li>思路：可靠的通信交给用户主机来保证（对网络层来说路由器也是主机）。</li>
<li>终点地址：每个分组都有终点的完整地址。</li>
<li>分组的转发、顺序：每个分组独立选择路由，不一定顺序到达终点。</li>
<li>节点出故障时：出故障的节点可能会丢失分组，但可以通过改变路由解决不可达问题。</li>
<li>端到端的差错处理和流量控制：由用户主机来保证。</li>
</ul>
</li>
</ol>
<h4 id="数据报服务（TCP-IP体系）"><a href="#数据报服务（TCP-IP体系）" class="headerlink" title="数据报服务（TCP/IP体系）"></a>数据报服务（TCP/IP体系）</h4><ul>
<li>网际协议IP（v4）<ul>
<li>与IP协议配套使用的还有三个协议：<ul>
<li>地址解析协议ARP（Address Resolution Protocol）(原RARP已经弃用)</li>
<li>网际控制报文协议ICMP(Internet Control Message Protocol)</li>
<li>网际组管理协议IGMP(Internet Group Management Protocol)</li>
</ul>
</li>
</ul>
</li>
<li><p>虚拟互联网络</p>
<ul>
<li><p>用户的需求是多样的，没有一种单一的网络能够适应所有用户的需求（微星链路、无线局域网、以太网等）。网络技术也是不断发展的，网络的制造厂家也要不断推出新的网络，在竞争中求生存。因此在市场上总是有很多不同性能、不同网络协议的网络，供不同用户选用。</p>
</li>
<li><p>当将网络互相连接起来使用的中间设备是转发器或网桥时，这仅仅是把一个网络扩大了，而从网络层的角度看，这仍然程为一个网络，一般并不称之为网络互连。现在我们讨论网络互联时，都是指用路由器进行网络互连和路由选择。路由器其实就是一台专用计算机，用来在互联网中进行路由选择。</p>
</li>
<li><p>参加互联的计算机网络都是用相同的网际协议IP（Internet Protocol）,因此可以把互联以后的计算机网络看成一个大的，主机直接连接的虚拟互连网络。所谓虚拟互连网络也就是逻辑互连网络，他的意思是互连起来的各种物理网络的异构性本来是客观存在的，但是我们利用IP协议就可以使这些性能各异的网络在网络层看起来好像是一个统一的网络，称为IP网。</p>
</li>
<li><p>优点：当IP网上的主机进行通信时，就好像在一个单个网络上通信一样，它们看不见互连的个网络的具体异构细节（如具体的编址方案、路由选择协议等）如果在这种覆盖全球的IP网上的上层使用TCP协议，那么就是现在的互联网。</p>
</li>
<li><p>当互联网中的一个主机H1要把一个IP数据报发送给目的主机H2时，主机H1要先查找自己的路由表，看目的主机是否就在本网络上。如果是就直接交付，任务就完成了，如果不是，则必须把数据报发送给某个路由器R1，路由器R1查找了自己的路由表（转发表）后，知道应把数据报转发给R2进行间接交付，这样一直转发下去，最后路由器R5知道自己是和H2连接在同一个网络上，不需要再使用别的路由器转发了，就把数据报直接交付目的主机H2。</p>
</li>
<li><strong>互联网可以由多种异构网络构成</strong></li>
</ul>
</li>
<li><p>分类的IP地址</p>
<ol>
<li><p>IP地址及其表示方法</p>
<ul>
<li>整个互联网就是一个单一的、抽象的网络。IP地址就是给互联网上的每一台主机（或路由器）的每一个接口分配i一个在全世界范围内是唯一的32位的标识符。IP地址的结构使我们可以在互联网上很方便的进行寻址。IP地址现在由互联网名字和数字分配机构ICANN进行分配。</li>
<li>IP编址方法共经过了三个历史阶段：<ol>
<li>分类的IP地址。最基本的编址方法，在1981年就通过了相应的</li>
<li>子网的划分。 对最基本的编址方法的改进，其标准RFC 950在1985年通过。</li>
<li>构成超网。这是比较新的无分类编址方法。1993年提出后很快就得到推广应用。</li>
</ol>
</li>
<li>分类的IP地址：<br>所谓分类的IP地址就是将IP地址划分为若干个固定类，每一类地址都由两个固定长度的字段组成，其中第一个字短视网络号（net-id），它标识主机（或路由器）所连接到的网络。一个网络号在整个互联网范围内必须是唯一的。第二个字段是主机号（host-id），它标识该主机（或路由器）。一台主机号在他前面的网络号所指的网络范围内必须是唯一的。由此可见，一个IP地址在整个互联网范围内是唯一的。<ul>
<li>A类、B类、C类地址的网络号字段分别为1个、2个、3个字节长，而在网络耗资段最前面有1~3位的 <strong>类别位</strong>，其数值分别规定为0，10，110.</li>
<li>A、B、C类地址的主机号字段分别为3个、2个、1个字节长。</li>
<li>D类地址（前四位是1110）用于多播。</li>
<li>E类地址（前四位是1111）保留为以后使用。</li>
<li>A类地址中网络号为127（01111111）保留为本地软件换回测试。</li>
<li>全零表示网络全1表示广播。</li>
</ul>
</li>
<li><p>IP地址具有以下一些重要特点。</p>
<ol>
<li>每一个IP地址都有网络号和主机号两部分组成，是一种 <strong>分等级的地址结构</strong>。分等级的好处：<ul>
<li>IP地址管理机构在分配IP地址时 <strong>只分配网络号</strong>，而剩下的主机号则由得到该网络号的单位自行分配。这样就方便了IP地址的管理。</li>
<li>路由器仅根据目的主机所连接的网络号来转发分组（而不考虑目的主机号），这样就可以使路由表中的项目数大幅减少，从而减少了路由表所占的存储空间以及查找路由表的时间。</li>
</ul>
</li>
<li>实际上IP地址是标识一台主机（或路由器）和一条链路的 <strong>接口</strong>。当一台主机同时连接到两个网络上时，该主机必须由两个相应的IP地址，其网络号必须是不同的。称为 <strong>多归属主机</strong>。</li>
<li>按照互联网的观点，一个网络是指具有相同网络号net-id的主机的集合，因此，用转发器或网桥连接起来的若干个局域网仍为一个网络，因为这些局域网都具有相同的网络号，具有不同网络号的局域网必须用路由器进行连接。</li>
<li>在IP地址中，所有分配到网络号的网络（不管是范围很小的局域网，还是范围很大的广域网）都是 <strong>平等的</strong>，互联网平等对待每一个IP地址</li>
</ol>
</li>
<li><p>我们应当注意到：</p>
<ul>
<li>在同一个局域网上的主机或路由器的IP地址种的网络号必须是一样的。</li>
<li>用网桥互连的的网段仍然是一个局域网，只能有一个网络号。</li>
<li>路由器总是具有两个或以上的IP地址，每一个接口都有一个不同的网络号的IP地址。</li>
<li>当两个路由器直接相连时，在连线两端的接口处，可以分配也可以不分配IP地址。如分配了IP地址，则这一段就构成了一种只包含一段线路的特殊网络。之所以叫网络是因为他有IP地址。但为了节省IP地址资源，对于这种仅有一段连线构成的特殊网络，现在也常常不分配网络。通常把这样的网络称为无边号网络或无名网络。</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
<li>IP地址与硬件地址（即物理地址也即MAC地址）<br> 从层次的角度看，物理地址是物理层和数据链路层使用的地址，而IP地址是网络层和以上各层使用的地址，是一种逻辑地址（用软件实现的）。<br> 在发送数据时，数据从高层下到低层，然后才到通信链路上传输。使用IP地址的IP数据报一旦交给了数据链路层，就被封装成MAC帧了。MAC帧在传送时使用的源地址和目的地址都是硬件地址，这两个硬件地址都写在MAC帧的首部中。</li>
<li>强调：<ol>
<li>在IP层抽象的互联网上只能看到IP数据报。</li>
<li>虽然在IP数据报首部有源站IP地址，但路由器只根据目的站的IP地址的网络号进行路由选择。</li>
<li>在局域网的链路层，只能看见MAC帧。IP数据报被封装在MAC帧中。MAC帧在不同网络上传送时，其MAC帧首部的源地址和目的地址要发生变化，路由器在收到MAC帧后，在数据链路层要丢弃原来的MAC帧的首部和尾部，在转发时重新添加自己出口的MAC地址和目的MAC地址。MAC帧的首部的这种变化，IP层是看不到的。</li>
<li>尽管互联在一起的网络的硬件地址体系各不同，但IP层抽象的互联网却屏蔽了下层这些很复杂的细节。只要我们在网络层上讨论问题，就能够使用统一的。抽象的IP地址研究主机和主机或路由器之间的通信。</li>
</ol>
</li>
<li>地址解析协议ARP<ul>
<li>为什么不直接使用硬件地址进行通信，转而用抽象的IP地址？<br>由于全世界存在着各式各样的网络，它们 <strong>使用不同的硬件地址</strong>。要使这些异构网络能够互相通信就必须进行非常复杂的硬件地址转换工作，因此由用户或用户主机来完成这项工工作几乎是不可能的事。但IP编址把这个复杂问题解决课。连接到互联网的主机只需各自拥有一个唯一的IP地址，它们之间的通信就像连接在同一个网络上那样简单方便，因为上述的调用ARP的复杂过程都是由计算机软件自动进行的，对用户来说是看不见这种调用过程的。</li>
<li>为了解决同一网段（同一局域网）内主机（或路由器）的IP地址和硬件地址的映射问题。</li>
<li>主机A向主机B发送一个IP报文的步骤：</li>
</ul>
<ol>
<li>主机A查找自己的ARP缓存表，如果由B的记录，将MAC填入帧头部发出。</li>
<li>若缓存表中无记录，主机A根据自己的掩码计算与主机B是否处于同一网段。</li>
<li>如果根据A的掩码计算A和B在同一网段（可能存在实际不在同一网段的情况192.168.1.10/16和192.168.128.10/24），广播ARP请求报文。</li>
<li>如果B在同一网段，回复APR回应报文。A将其中MAC地址填入MAC帧发出。</li>
<li>如果实际不在同一网段，若设置了代理ARP，代理ARP会根据自己的路由表回应（代理ARP只响应那些在自己的路由表里能找到的网段）。若无代理APR或ARP路由表中无记录则丢弃该报文。</li>
<li>若A根据自己的掩码计算与B不属于同一网段，则会发给网关，先用网关的IP请求其MAC地址，然后将报文的MAC地址填上网关的MAC发送。</li>
<li>网关根据路由表转发。</li>
</ol>
</li>
<li>IP数据报的格式：<ul>
<li>IP数据报首部的固定部分的字段：</li>
</ul>
<ol>
<li>版本：4位。IP协议的版本。</li>
<li>首部长度：4位。单位：32字长（4字节）。</li>
<li>区分服务：8位，用来获取更好的服务。一般不使用。</li>
<li>总长度：16位。指首部和数据之和的长度。单位为字节。理论上来说最多可有65535字节但受数据链路层MTTU的限制，若超过MTU的值就必须把过长的数据报进行分片处理。</li>
<li>标识（identification）：16位。IP软件在存储器中维持一个计数器，每产生一个数据报，计数器就+1，并将此值赋给标识字段。当数据报超过MTU需要分片时，这个标识字段就被复制到所有的数据报片的标识字段中。相同的标识字段的值使分片后的各数据报片最后能正确的重装为原来的数据报。</li>
<li>标志（flag）：3位。但目前只有两位有意义。<br>MF（More Fragment）MF=1表示后面还有分片的数据报。MF=0则说明这是该数据报最后一个。<br>DF（Don’t Fragment）DF=0时允许分片。</li>
<li>片偏移：13位。</li>
<li>生存时间TTL：8位。</li>
<li>协议：8位。指出此数据报携带的数据是使用何种协议，以便目的主机的IP层知道应将数据部分上交给哪个协议进行处理。</li>
<li>首部检验和：16位。只检验数据报的首部，但不包括数据部分。</li>
<li>源地址：32位</li>
<li>目的地址：32位</li>
</ol>
<ul>
<li>IP数据报首部的可变部分：<br>就是一个选项字段。</li>
</ul>
</li>
<li><p>IP层转发分组的流程</p>
<ol>
<li>从数据报的首部提取目的主机的IP地址D，得到目的网络地址为N。</li>
<li>若N就是与此路由器直接相连的某个网络地址，则进行直接交付，不需要再经过其他的路由器，直接把数据报交付的目的主机（包括把目的主机D转换为具体的硬件地址，把数据报封装成MAC帧，再发送此帧。）；否则就间接交付执行（3）。</li>
<li>若路由表中有目的地址为D的特定主机路由，就把数据报传送给路由表中所指明的下一跳路由器；否则，执行（4）。</li>
<li>若路由表中有到达网络N的路由，则把数据报传送给路由表中所指明的下一跳路由器；否则，执行（5）。</li>
<li>若路由表中有一个默认路由，则把书记宝传送给路由表所指明的默认路由器，否则执行（6）。</li>
<li>报告转发分组出错。</li>
</ol>
<p>怎样找到下一跳路由器：<br> 从路由表中得到下一跳路由器的IP地址后，不是把这个地址填入IP数据报，二十送交数据链路层的网络接口软件。网络接口软件负责把下一跳路由器的IP地址转换成硬件地址（必须使用ARP），并将此硬件地址放在链路层MAC帧的首部。然后根据MAC地址找到下一跳路由器。（在交付过程中源、目的IP地址是不会变的，源、目的MAC地址会变成两个端口的MAC）。</p>
<h4 id="划分子网和构造超网"><a href="#划分子网和构造超网" class="headerlink" title="划分子网和构造超网"></a>划分子网和构造超网</h4><h5 id="划分子网"><a href="#划分子网" class="headerlink" title="划分子网"></a>划分子网</h5></li>
</ul>
<ol>
<li>从两级IP地址到三级IP地址<ul>
<li>两级分类地址缺陷：</li>
</ul>
<ol>
<li>IP地址空间的利用率有时很低。有的单位申请B类网址而不是够用的C类网址，理由是考虑日后发展。IP地址的浪费还会使IP地址空间的资源过早的被用完。</li>
<li>给每一个物理网络分配一个网络号会使路由表变得太大而使网络性能变坏。</li>
<li>两级IP地址不够领过。<br>为了解决上述问题，1985年起IP地址中又增加了一个“子网号字段”，使两级IP地址变为三级IP地址。这种做法叫做划分子网（subnetting）（RFC 950），或子网寻址或子网路由选择。</li>
</ol>
<ul>
<li>划分子网的基本思路：</li>
</ul>
<ol>
<li>一个拥有许多物理网络的单位，可将所属的物理网络划分为若干个 <strong>子网</strong>（subnet）。划分子网纯属一个单位内部的事情。本单位以外的网络看不见这个网络室友多少个子网组成，因为这个单位对外 <strong>仍然表现为一个网络</strong>。</li>
<li>划分子网的方法是从网络的主机号借用若干位作为子网号（subnet-id），当然主机号也就减少了同样的位数。于是两级IP地址在 <strong>本单位内部</strong> 就变为三级IP地址：网络号、子网号和主机号。<br>IP地址 ::={&lt;网络号&gt;,&lt;子网号&gt;,&lt;主机号&gt;}</li>
<li>凡是从其他网络发送给本单位某台主机的IP数据报，仍然是根据IP数据报的目的网络号找到链接在本单位网络上的路由器。但此路由器在收到IP数据报后，再按目的网络号和子网号找到目的子网，把IP数据报交付给目的主机。</li>
</ol>
</li>
<li>子网掩码<ul>
<li>从IP数据报的首部无法看出源主机或目的主机所连接的网络是否进行了子网划分，使用子网掩码。</li>
<li>子网掩码是一个网络或一个子网的重要属性。</li>
<li>划分子网增加了灵活性，但却减少了能够连接在网络上的主机总数。<h5 id="使用子网时分组的转发"><a href="#使用子网时分组的转发" class="headerlink" title="使用子网时分组的转发"></a>使用子网时分组的转发</h5></li>
</ul>
</li>
<li>使用子网划分后，路由表必须包含：目的网络地址、子网掩码、下一跳地址。</li>
<li>在划分子网的情况下，路由器转发分组的算法如下：<ol>
<li>从收到的数据报的首部提取目的IP地址D。</li>
<li>先判断是否为直接交付。对路由器直接相连的网络逐个进行检查：用各网络的子网掩码和D逐位相与，看结果是否和相应的网络地址匹配。若匹配，则把分组进行直接交付（当然还需要把D转换成物理地址，把数据报封装成帧发送出去），转发任务结束，否则就是间接交付，步骤三。</li>
<li>若路由表中有目的地址为D的特定主机路由，则把数据报传送给路由表中所指明的下一跳路由器；否则执行（4）。</li>
<li>对路由表中的每一行（目的网络地址，子网亚麻，下一跳地址），用去只不过的子网掩码和D逐位相与，其结果为N。若N与该行的目的网络地址匹配，则把数据报传送给该行指明的下一跳路由器；否则，执行（5）。</li>
<li>若路由表中有一个默认路由，则把数据报传送给路由表中所指明的默认路由器；否则，执行（6）。</li>
<li>报告分组转发出错。<h5 id="无分类地址CIDR（构造超网）"><a href="#无分类地址CIDR（构造超网）" class="headerlink" title="无分类地址CIDR（构造超网）"></a>无分类地址CIDR（构造超网）</h5></li>
</ol>
</li>
</ol>
<ul>
<li><p>网络前缀<br>划分子网在一定程度上缓解了互联网在发展中遇到的困难。然而在1992年互联网仍然面临三个问题：</p>
<ol>
<li>B类地址在1992年已经分配了一半，眼看很快就要分配完。</li>
<li>互联网主干网上的路由表中的项目数急剧增长（从几千个增长到几万个）。</li>
<li>整个IPv4的地址空间最终将全部耗尽。在2011年2月3日，IANA宣布IPv4地址已经耗尽了。</li>
</ol>
<ul>
<li>当时预计前两个问题将会变得非常严重，因此IETF很快就研究出来采用无分类编址的方法来解决前两个问题。IETF认为上面的第三个问题属于更加长远的问题，因此专门成立IPv6工作组负责研究解决新版IP协议的问题。</li>
<li>其实早在1987年，RFC 1009就指明了在一个划分子网的网络中课同时使用几个不同的子网掩码。使用变长子网掩码VLSM(Variable Length Subnet Mask)可进一步提高IP地址资源的利用率。在VLSM的基础上又进一步研究出 <strong>无分类编址方法</strong>，它的正式名字是 <strong>无分类域间路由选择CIDR</strong>(Classless Inter-Domain Routing)。</li>
<li>CIDR最主要的特点有两个：</li>
</ul>
<ol>
<li>CIDR消除了传统的A类、B类和C类地址以及划分子网的概念，因而能更加有效的分配IPv4的地址空间，并且在新的IPv6使用之前容许互联网的规模继续增长。CIDR把32位的IP地址划分为前后两个部分。前面部分是“ <strong>网络前缀</strong> （netowrk-orefix）”或简称为前缀，来指明网络，后面部分则用来指明主机。因此CIDR使IP地址从三级编址又回到了两级编址，但这已是无 <strong>分类的两级编址</strong>。其记法是：<pre><code>IP地址::={&lt;网络前缀&gt;，&lt;主机号=&gt;}
</code></pre>CIDP还使用谢贤激发，或称为CIDR记法，即在IP地址后面加上斜线/然后写上网络前缀占的位数。</li>
<li>CIDR把 <strong>网络前缀都相同</strong> 的连续的IP地址组成一个“<strong>CIDR地址块</strong>”。我们只要知道CIDR地址块中的任何一个地址，就可以知道这个地址块的起始地址（即最小地址）和最大地址，以及地址块中的地址数。</li>
</ol>
<ul>
<li>由</li>
</ul>
<p>于一个CIDR地址块中有很多地址，所以在路由表中就利用CIDR地址块来查找目睹网络。这种地址的聚合常常称为 <strong>路由聚合</strong>。也称为 <strong>构成超网</strong>。</p>
</li>
<li>最长前缀匹配<br>在使用CIDR时，路由表中每个项目由“网络前缀”和“下一跳地址”组成。但是在查找路由表时可能会得到不止一个匹配结果，应当从匹配结果中选择具有最长网络前缀的路由。这叫最长前缀匹配。</li>
<li>使用二叉线索树查找路由表<br>使用CIDR后，由于要寻找最长前缀匹配，使路由表的查找过程变得更加复杂了。二叉线索树查找应运而生。二叉线索树中的每个路径就代表路由表中存放的各个地址。<h4 id="网际控制报文ICMP"><a href="#网际控制报文ICMP" class="headerlink" title="网际控制报文ICMP"></a>网际控制报文ICMP</h4></li>
<li>为了更有效的转发IP数据报和提高交付成功的机会，在网际层使用了 <strong>网际控制报网协议ICMP</strong>(Internet Control Message Protocol)。ICMP允许主机或路由器报告差错情况和提供有关异常情况的报告。ICMP是互联网的标准协议。但ICMP不是高层协议（看起来好像是高层协议，因为ICMP报文是封装在IP数据报中，作为其中的数据部分）是IP层协议。ICMP报文作为IP层数据报的数据，加上数据报的首部，组成IP数据报发送出去。</li>
<li>ICMP报文的种类<ul>
<li>ICMP的种类有两种：ICMP差错报告报文和ICMP询问报文。</li>
<li>ICMP差错控制报文：</li>
</ul>
<ol>
<li>终点不可达：类型值 3。当路由器或主机不能交付数据报时就向源站点发送终点不可达报文。</li>
<li>时间超过：类型值 11。当路由器收到生存时间为0的数据报时，除丢弃该数据报外，还要向源点发送时间超过报文。当重点在预先规定的时间内不能收到一个数据报的全部数据报片时，就把已收到的数据报片都丢弃，并向源站点发送时间超过报文。</li>
<li>参数问题：类型值 12。当路由器或目的主机收到的数据报的首部中有的字段的值不正确时，就丢弃该数据报，并向源点发送参数问题报文。</li>
<li>改变路由（重定向）：类型值 5。路由器把改变路由报文发送给主机，让主机直到下次应将数据报发送给另外的路由器（可通过更好的路由）。<br>下面是不应发送ICMP差错报告报文的几种情况：<ul>
<li>对ICMP差错报告报文，不再发送ICMP差错报告报文。</li>
<li>对第一个分片的数据报的所有后序分片，都不发送ICMP差错报告报文。</li>
<li>对具有多波地址的数据报，都不发送ICMP差错报告报文。</li>
<li>对具有特殊地址（127.0.0.0，0.0.0.0）的数据报，不发送ICMP差错报告报文。</li>
</ul>
</li>
</ol>
<ul>
<li>ICMP询问报文：</li>
</ul>
<ol>
<li>回送请求和回答 ICMP回送请求报文是由主机或路由器向一个特定的目的主机发出的询问。收到此报文的主机必须给源主机或路由器发送ICMP回送报文。这种询问报文用来测试目的站是否可达以及连接有关状态。</li>
<li>时间戳请求和回答 用于时钟同步和时间测量。</li>
</ol>
</li>
<li>ICMP应用举例<br>分组网间探测PING(Packet InterNet Groper)，用来测试两台主机的连通性。<br>路由追踪traceout。利用了ICMP时间超过报文。将TTL从1递增，并在IP数据报中封装一个无法交付的UDP数据报（使用非法端口号）。<h4 id="互联网的路由选择协议"><a href="#互联网的路由选择协议" class="headerlink" title="互联网的路由选择协议"></a>互联网的路由选择协议</h4></li>
<li>有关路由表的几个基本概念<ol>
<li>理想的路由算法</li>
</ol>
<ul>
<li>算法必须是正确的和完整的。</li>
<li>算法在计算上应简单。</li>
<li>算法能适应通信量和网络拓扑的变化（自适应性）。</li>
<li>算法应具有稳定性。</li>
<li>算法应是公平的。</li>
<li>算法应是最佳的。</li>
</ul>
<ol start="2">
<li>分层次的路由选择协议<br>互联网采用的路由选择协议主要是自适应的、分布式路由选择协议。由于以下两个原因，互联网采用分层次的路由选择协议：</li>
</ol>
<ul>
<li>互联网的规模非常大。如果让所有的路由器知道所有的网络应怎样到达，则这种路由表将非常大，处理起来太花时间。而所有这些路由器之间交换路由信息就会使互联网的通信链路饱和。</li>
<li>许多单位不愿意外界了解自己单位网络上的不拘细节和本部门所采用的路由选择协议，但同时还希望连接到互联网上。<br>为此，可以把整个互联网划分为许多较小的 <strong>自治系统</strong>(autonomous system)，一般都记为AS。自治系统AS是在单一技术管理下的一组路由器而这些路由器使用一种自制系统内部的路由选择协议和共同的度量。一个AS对其他AS表现出的是一个单一的和一致的路由选择策略。</li>
<li>在目前的互联网中，<strong>一个大的ISP就是一个AS</strong>，这样，互联网就把路由器划分成两大类，即：<ol>
<li>内部网关协议IGP。即在一个自治系统内部使用的路由选择协议，而这与在互联网中的其他自治系统选用什么路由选择协议无关。目前这类路由选择协议使用最多。</li>
<li>外部网关协议EGP。若源主机和目的主机处在不同的AS中，当数据报传到一个自治系统的边界时，就需要使用一种协议将路由选择信息传递到另一个自治系统中。这样的协议就是外部网关协议EGP。</li>
</ol>
<ul>
<li>自治系统之间的路由选择也叫做域间路由选择，AS内的路由选择叫做域内路由选择。</li>
</ul>
</li>
</ul>
</li>
<li>内部网关协议RIP(Routing Information Protocol)<ol>
<li>工作原理</li>
</ol>
<ul>
<li>RIP是内部网关协议IGP中最先得到广泛使用的协议，它的中文名叫做路由信息协议，但很少被使用。RIP是一种分布式的 <strong>基于距离向量的路由选择协议</strong>，（距离指跳数）是互联网的标准协议，其最大的优点就是简单。</li>
<li>局限：RIP允许一条路径最多包含15个路由器，可见PIR只适用于小型互联网。</li>
<li>RIP的特点是：<ol>
<li>仅和相邻路由器交换信息。如果两个路由器之间的通信不需要经过另一个路由器，那么这两个路由器就是相邻的。</li>
<li>路由器交换的信息是当前本路由器所知道的全部信息，即自己现在的路由表。也就是说交换的信息是：“我到本自治系统中所有网络的最短距离，以及到每个网络应该经过的下一跳路由器。”</li>
<li>按固定的时间间隔交换路由信息，例如，每隔30秒。然后路由器根据收到的路由信息更新路由表。当网络拓扑发生变化时，路由器也及时向相邻路由器通告拓扑变化后的路由信息。<br>这里要强调一点：路由器在刚刚开始工作的时候，它的路由表是空的。然后路由表就得出到直接相连的几个网络的距离（这些距离定义为1）。接着，每一个路由器也只和数目非常有限的相邻路由器交换并更新路由信息。经过若干次的更新后，所有的路由器最终都会知道到本自治系统中任何一个网络的最短距离和下一跳路由器的地址。</li>
</ol>
</li>
</ul>
<ol start="2">
<li>距离向量算法<br>对每一个相邻路由器发送过来的RIP报文，进行以下步骤：</li>
<li>对地址为X的相邻路由器发来的RIP报文，先修改此报文中的所有项目：把“下一跳”字段种的地址都改为X，并把所有的“距离”字段的值+1.每一个项目都有三个关键数据，即：到目的网络N，距离是d，下一跳路由器是X。</li>
<li>对修改后的RIP报文种的每一个项目，进行以下步骤：<br>若原来的路由表中没有目的网络N，则把该项目调价到路由表中。<br>否则（即在路由表中有目的网络N，这时就再查看下一跳路由器地址）<br>若下一跳路由器地址是X，则把收到的项目替换原路由表种的项目。<br>否则（即这个项目是：到目的网络N，但下一跳路由器不是X）<br>  若收到的项目种的距离d小于路由表中的距离，则进行更新<br>  否则什么也不做。</li>
<li>RIP报文的格式</li>
<li>RIP协议使用运输层的用户数据报协议UDP（520端口）进行传送。</li>
<li>RIP报文由首部和路由部分组成。</li>
<li>RIP2报文中的路由部分由若干个路由信息组成，每个路由信息需要用20个字节。<strong>地址族标识符</strong> 又称地址类别字段用来标志所使用的地址协议。如采用IP地址就令这个字段的值为2（原来考虑RIP也可以用于其他非TCP/IP协议的情况）。路由标记填入自治系统号ASN(Autonomous System Number)，这是考虑到RIP有可能收到其他AS内的路由选择信息。在后面指出某个网络地址、该网络的子网掩码、下一跳路由器地址以及到此网络的距离。一个RIP报文最多可包括25个路由，最大长度4+20*25=504字节。如超过需再用一个RIP报文发送。</li>
<li>RIP的缺点</li>
<li>RIP限制了网络的规模，最大距离15（16不可达）。</li>
<li>路由器之间交换的信息是路由器中的完整的路由表，因而随着网络规模的扩大，开销也就增加。</li>
<li>当网络出现故障时，要经过比较长时间才能将此信息传送到所有的路由器。即更新过程的收敛时间过长。<br>因此，对于规模较大的网络就应当使用OSPF协议。然而目前在规模较小的网络中，使用RIP协议的仍占多数。</li>
</ol>
</li>
<li>内部网关协议OSPF(Open Shortest Path First)<ul>
<li>开放最短路径优先，其原理简单但实现复杂。“开放”表明OSPF协议不是受某一家厂商控制，二十公开发表的。“最短路径优先”是因为使用了迪杰斯特拉提出的最短路径算法SPF。OSPF的第二个版本OSPF2已经成为了互联网标准协议。</li>
<li>OSPF最主要的特征就是使用分布式的 <strong>链路状态协议</strong>(link state protocol)，而不是像RIP那样的距离向量协议。和RIP相比，OSPF的三个要点和RIP 的不同：</li>
</ul>
<ol>
<li>向本自治系统中的所有路由器发送消息。这里使用的方法是洪泛法，这就是路由器通过所有输出端口想所有相邻的路由器发送消息。而每一个相邻路由器又将此消息发往其所有的相邻路由器（除刚刚发来信息的路由器）。这样，最终整个区域中所有的路由器都得到了这个信息的一个副本。</li>
<li>发送的信息就是与本路由器相邻的所有路由器的链路状态，单着只是路由器所知道的部分信息。所谓“链路状态”就是说明本路由器都和那些路由器相邻，以及该链路的度量（代价）。</li>
<li>只有当链路状态发生变化时，路由器才向所有路由器用洪泛法发送此消息。</li>
</ol>
<ul>
<li>由于个路由器之间频繁的交换链路状态信息，因此所有的路由器最终都能建立一个链路状态数据库，实际上就是全网拓扑图。这个拓扑结构在全网范围内是一致的。</li>
<li>OSPF的链路状态数据库能较快的进行更新，使各个路由器能及时更新其路由表。OSPF的更新过程收敛的快是其重要优点。</li>
<li>OSPF的层次结构区域划分</li>
<li>为了使OSPF能够用于规模很大的网络，OSPF将一个自治系统再划分为若干个更小的范围，叫做区域。每个区域都有一个32位的区域标识符，一个区域内的路由器最好不超过200个。</li>
<li>划分区域的好处就是把利用洪泛法交换链路状态信息的范围局限于每一个区域而不是整个的自治系统，这就减少了整个网络上的通信量。在一个区域内部的路由器只知道本区域的完整网络拓扑，而不知道其他区域的网络拓扑情况。</li>
<li>为了使每一个区域能够和本区域意外的区域进行通信，OSPF使用层次结构的区域划分。在上层的区域叫做主干区域，主干区域的标识符定为0.0.0.0，主干区域的作用是用来联通其他在下层的区域。从其他区域来的信息都由区域边界路由器进行概括。</li>
<li>每一个区域至少有一个区域边界路由器。来概括并向主干区域发送本区域内的链路状态信息。</li>
<li>主干区域的路由器称主干路由器</li>
<li>在主干区域内还要有一个路由器专门和其他自制系统交换路由信息，叫做在自制系统边界路由器。</li>
<li>OSPF报文：</li>
<li>OSPF不用UDP二十直接用IP数据报传送（89）。24字节的首部：<ol>
<li>版本</li>
<li>类型（五种）</li>
<li>分组长度</li>
<li>路由器标识符  标志发送该分组的路由器的接口的IP地址。</li>
<li>区域标识符  分组属于的区域的标识符。</li>
<li>校验和  用来检测分组中的差错。</li>
<li>鉴别类型  </li>
<li>鉴别</li>
</ol>
</li>
</ul>
</li>
</ul>
<pre><code>- OSPF同意链路不同业务可设置不同代价从而计算出不同路由；若有代价相同的若干路径，进行负载平衡；仅在可信赖的路由器之间交换链路状态信息；每一个链路状态带一个32位的序号，序号越大状态越新，并规定链路状态序号增长的速率不超过5秒1次。
</code></pre><ul>
<li>OSPF的五种分组类型<ol>
<li>问候(Hello)分组，用来发现和维持邻站的可达性。</li>
<li>数据库描述(Database Description)分组，向邻站给出自己的链路状态数据库中所有链路状态项目的概要信息。</li>
<li>链路状态请求(Link State Request)分组，向对方请求发送某些链路状态项目的详细信息。</li>
<li>链路状态更新(Link State Update)分组，用洪泛法对全网更新链路状态。这种分组是最复杂的，也是OSPF协议最核心的部分。</li>
<li>链路状态确认(Link State Acknowledgment)分组，对链路更新分组的确认。</li>
</ol>
<ul>
<li>OSPF规定，每两个相邻路由器每隔10秒要交换一次问候分组，确保邻站可达。40秒未收到某个相邻路由器发来的问候分组，认为其不可达，立即修改链路状态数据库，并重新计算路由表。</li>
<li>两个相邻路由器的链路状态数据库同步称为完全邻接。</li>
<li>在网络运行过程中，只要有一个路由器的链路状态发生变化，该路由器就要使用链路状态更新报文洪泛。收到洪泛的确认。</li>
<li>若多个路由器连接在一个以太网上即多点接入的局域网采用 <strong>指定的路由器</strong> 方法，代表该局域网上所有的链路想连接到该网络上的各路由器发送状态信息。</li>
<li>外部网关协议BGP</li>
<li>我们知道，内部网关协议主要是设法使数据报在一个AS中尽可能有效的从源站传送到目的站。在一个AS内部也不需要考虑其他方面的策略。然而BGP使用的环境却不同。主要是以下两个原因：</li>
</ul>
</li>
</ul>
<ol>
<li>互联网规模太大，使得自治系统AS之间路由选择非常困难。比较合理的做法是在自治系统之间交换“可达性信息”。</li>
<li>自治系统AS之间的路由必须考虑有关策略。<br>边界网关协议BGP只能是力求寻找一条能够到达目的网络且比较好的路由（不能兜圈子），而并非要寻找一条最佳路由。BGP采用了路径向量路由选择协议。<ul>
<li>在配置BGP时，每一个自治系统的管理员要选择至少一个路由器作为该AS的BGP发言人。一般来说，两个发言人都是通过一个共享网络连接在一起的。而BGP发言人往往就是BGP边界路由器。</li>
<li>一个BGP发言人要与其他AS的BGP发言人交换路由信息，就要先建立TCP连接，然后在此连接上交换BGP报文以建立BGP会话。<h4 id="IP多播"><a href="#IP多播" class="headerlink" title="IP多播"></a>IP多播</h4></li>
<li>基本概念：<br>如多播视频，视频服务器只需将视频分组当做多播数据报发送，只需发送一次，路由器在转发时，将受到的分组复制分发。当分组到达目的局域网时，进行硬件多播。</li>
<li>在局域网上进行硬件多播<h4 id="虚拟专用网VPN"><a href="#虚拟专用网VPN" class="headerlink" title="虚拟专用网VPN"></a>虚拟专用网VPN</h4>采用隧道技术（即IP-in-IP）,在公网IP报文中封装专用网IP报文作为数据部分。<h4 id="网络地址转换NAT-NAPT"><a href="#网络地址转换NAT-NAPT" class="headerlink" title="网络地址转换NAT(NAPT)"></a>网络地址转换NAT(NAPT)</h4>出口路由器维护一个公网IP+端口到内网IP的映射表。</li>
</ul>
</li>
</ol>
<h3 id="网络设备概要"><a href="#网络设备概要" class="headerlink" title="网络设备概要"></a>网络设备概要</h3><ul>
<li>我们根据在网络中所工作的层把连接设备定义为五类：<ol>
<li>工作在物理层以下的设备，如无源集线器。</li>
<li>工作在物理层的设备，中继器或有源集线器。</li>
<li>工作在物理层和数据链路层的设备，网桥或两层交换机。</li>
<li>工作在物理层、数据链路层和网络层的设备，三层交换机或路由器。</li>
<li>工作在所有五层的设备，网关。<br>——摘自《数据通信与网络》</li>
</ol>
</li>
</ul>
<ol>
<li><p>主机上的适配器（网卡）<br>连接主机与外界局域网，装有处理器和存储器（包括RAM和ROM）。适配器和局域网之间的通信是通过电缆或双绞线通过串行方式传输数据，与主机通信是通过主板上的I/O总线以并行方式传输的，所以适配器的一个重要功能就是要进行数据串行传输和并行传输的转换。由于网络上的数据率和计算机总线上的数据率不相同，因此适配器中必须装有对数据进行缓存的存储芯片。对计算机来说适配器也是一种I/O设备。MAC地址就存在适配器的ROM中。</p>
<p>主板上插入适配器时，必须把管理该适配器的设备驱动程序安装在计算机操作系统中，这个驱动程序会告诉适配器，应当从存储器的什么位置上把多长的数据块发送到局域网，或者应当在存储器的什么位置上把局域网传送过来的数据块存储下来，适配器要能够实现以太网协议。</p>
<p>适配器在接受和发送各种帧时，不使用计算机的CPU。当适配器收到有差错的帧时，就把这个帧丢弃而不必同志计算机。当适配器接收到正确的帧时，用中断方式通知计算机，并交付协议栈中的<strong>网络层</strong>。当计算机要发送IP数据报时，就由协议栈把IP数据报向下交给适配器，组装成帧后发送到局域网。也就是说包含了数据链路层和物理层两个层次的功能</p>
</li>
<li><p>物理层的有源集线器(hub)<br>集线器工作在物理层，它的接口仅仅简单的转发比特，收到1就转发1（向除发送接口的其它所有接口转发）</p>
</li>
<li><p>网桥(bridge)</p>
<ul>
<li>功能：工作在物理层和数据链路层。用作物理层设备时，它重新生成接收到的信号。用作数据链路层设备时，它可以检查帧所包含的物理地址，根据端口地址映射表决定该帧是转发还是丢弃。网桥一个端口连接的是一个冲突域。</li>
<li>透明网桥(transparent Bridge)是一个他所连接的站点完全意识不到其存在的网桥。在系统中增加或移除一个透明网桥，则不需要重新配置。透明网桥符合以下三条标准：<ol>
<li>帧必须能从一个站点发送到另一个站点。</li>
<li>通过学习网络中的帧，自动建立转发表。</li>
<li>避免系统内循环。<br>以下讨论针对透明网桥。</li>
</ol>
</li>
<li>转发表：端口与主机MAC地址的对应关系，通常一个端口对应多个MAC地址。接收到帧后网桥根据帧中的源MAC地址维护自己的转发表，并查找目的MAC地址是否有记录，有记录则转发到对应端口，发送到该端口对应的冲突域中；无记录则向所有端口转发此帧。</li>
<li>循环问题<br>为了保证网络的高可用性，通常会使用冗余网桥，在两个冲突域之间使用多个网桥，如果一个网桥失效，另一个网桥会接管。不幸的是，冗余带来了循环问题。例：<br>在系统中使用两个网桥连接两个LAN产生循环：<ol>
<li>位于LAN1的站点A向LAN2的站点D发送一帧。两个网桥的转发表都是空的，所以都转发帧，并根据A的MAC地址更新自己的转发表。</li>
<li>现在LAN2中有两分该帧的拷贝。网桥1发出的拷贝网桥2也会接收，但是网桥2的转发表里没有目的地址D的信息，向所有端口转发此帧。网桥1同样也会收到网桥2的拷贝，也会向所有端口转发。</li>
<li>现在LAN1中有了该帧的两份拷贝，又重复上一步骤的过程，每个帧都在网络中泛滥。</li>
<li>这个过程一直持续。注意，网桥也是中继器，并且重新生成帧。所以在每次重复中，都有该帧重新生成的新拷贝。</li>
</ol>
</li>
<li>生成树(spanning tree)<ul>
<li>为了解决循环问题，IEEE规范需要网桥使用生成树算法来建立无循环拓扑结构。生成树是一个没有循环路径的图。</li>
<li>算法步骤：<ol>
<li>每个网桥有一个内置的ID（通常是唯一的序列号（MAC））。每个网桥广播它的ID，这样所有王巧都知道那个是最小的ID。选ID最小的网桥作为根网桥（生成树的根）。</li>
<li>以根网桥为最小生成树的根，生成一个最小生成树。</li>
<li>基于生成树，标记术语生成树部分的咹为 <strong>转发端口</strong>(forwarding prot)，它转发网桥收到的帧，标记不属于生成树部分的端口为 <strong>阻塞端口</strong>(blocking port)，它阻塞网桥接收到的帧。</li>
<li>动态算法。每个网桥都配置了一个软件包来动态的完成这个过程，网桥互相发送称为网桥协议数据单元BPDU的特定消息，用来更新生成树。当系统有变化时，如某个网桥出现故障或者增加移除网桥，生成树都需要更新。</li>
</ol>
</li>
</ul>
</li>
<li>源路由网桥：是IEEE设计用于令牌环局域网的防止冗余网桥系统的循环问题的方法。</li>
</ul>
</li>
<li><p>二层交换机(two-layer switch)</p>
<ul>
<li>洪泛和广播：<ul>
<li>洪泛：二层交换机对未知单播会洪范，帧结构和源目的MAC不变，发给除去接收的所有端口。二层行为。由于“FF.FF.FF.FF.FF.FF”是广播地址，永远都不会出现在源MAC字段，所以永远不会被交换机学习到。配置了VLAN，学习过程、转发过程都需要检查帧头802.1Q的VLAN ID字段，泛洪也只在属于该VLAN ID的端口上泛洪。</li>
<li>广播：“FF.FF.FF.FF.FF.FF”只能出现在目的MAC字段，所以交换机永远都匹配不到，只有泛洪，该VLAN里的所有端口都可以接收到，此乃广播。</li>
</ul>
</li>
<li>两层交换机是一个有许多端口并且有更好（更快）性能的网桥。</li>
<li>有少量端 口的网桥只可以连接几个局域网。有更多端口的网桥可以给每个站点分配唯一的端口，每个站点都作为独立的实体，这意味着没有通信量竞争（没有以太网中见到的冲突）。</li>
<li>两层交换机像网桥一样，基于收到帧的MAC地址做出过滤决策。但是，两层交换机更加复杂。它有缓存区来保存帧进行处理，由交换组件使得更快地转发帧。快速交换机：一检查到帧头部的MAC地址就转发帧。</li>
</ul>
</li>
<li>路由器(router)<ul>
<li>路由器是三层设备，它基于分组的逻辑地址（主机到主机寻址）路由分组。路由器通常连接LAN和路由器中的WAN，它有一张表（路由表）来决策路由。</li>
</ul>
</li>
<li>三层交换机(three-layer switch)<ul>
<li>三层交换机是路由器，但更快更复杂。三层交换机中的交换光纤允许更快的表查询和转发。</li>
</ul>
</li>
</ol>
<h3 id="2018-5-8"><a href="#2018-5-8" class="headerlink" title="2018.5.8"></a>2018.5.8</h3><ol start="2">
<li>三张表：<ol>
<li>ARP缓存表：</li>
<li>MAC地址表</li>
<li>路由表</li>
</ol>
</li>
</ol>
</div><div class="tags"><a href="/tags/基础/">基础</a></div><div class="post-nav"><a class="pre" href="/2018/05/08/计算机组成原理知识树/">计算机组成原理知识树</a><a class="next" href="/2018/05/05/hadoop错误汇总/">hadoop错误汇总</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JSP-Servlet-JDBC开发日记/">JSP+Servlet+JDBC开发日记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">spark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark实战/">spark实战</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/云计算/">云计算</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构与算法/">数据结构与算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/组成原理/">组成原理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络编程/">网络编程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机网络/">计算机网络</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/centos/" style="font-size: 15px;">centos</a> <a href="/tags/spark，IDEA/" style="font-size: 15px;">spark，IDEA</a> <a href="/tags/jsp/" style="font-size: 15px;">jsp</a> <a href="/tags/servlet/" style="font-size: 15px;">servlet</a> <a href="/tags/JDBC/" style="font-size: 15px;">JDBC</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/分布式/" style="font-size: 15px;">分布式</a> <a href="/tags/spark/" style="font-size: 15px;">spark</a> <a href="/tags/hadoop-错误/" style="font-size: 15px;">hadoop 错误</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/hadoop，IDEA/" style="font-size: 15px;">hadoop，IDEA</a> <a href="/tags/模式匹配/" style="font-size: 15px;">模式匹配</a> <a href="/tags/Mina/" style="font-size: 15px;">Mina</a> <a href="/tags/基础/" style="font-size: 15px;">基础</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/06/24/Spark实战：统计电影评分/">Spark实战：统计电影评分</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/29/初学Mina/">初学Mina</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/29/IDEA运行第一个spark（WordCount）/">IDEA运行第一个spark（WordCount）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/29/spark问题记录/">spark问题记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/10/windows下IDEA远程连接Hadoop/">windows下IDEA远程连接Hadoop</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/09/再谈KMP——KMP的证明及优化/">再谈KMP——KMP的证明及优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/08/操作系统知识树/">操作系统知识树</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/08/计算机组成原理知识树/">计算机组成原理知识树</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/08/计算机网络知树/">计算机网络知识树</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/05/hadoop错误汇总/">hadoop错误汇总</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/Deeeeeeepth/" title="My Github" target="_blank">My Github</a><ul></ul><a href="http://www.rxdonny.com/" title="donny's blog" target="_blank">donny's blog</a><ul></ul><a href="http://www.hut.edu.cn/" title="hut" target="_blank">hut</a><ul></ul><a href="http://www.gunpowder.net.cn/" title="gunpowder's" target="_blank">gunpowder's</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Ranranran.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>